<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plastering Apprentice App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #333; color: #fff; padding: 1em; text-align: center; }
    nav { display: flex; justify-content: space-around; background: #555; padding: 0.5em; }
    nav button { color: #fff; background: none; border: none; font-size: 1em; cursor: pointer; }
    nav button:hover { text-decoration: underline; }
    .screen { display: none; padding: 1em; }
    .active { display: block; }

    .guide-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1em;
      margin-bottom: 1em;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }
    .image-placeholder {
      border: 1px dashed #aaa;
      border-radius: 8px;
      padding: 0.75em;
      margin-top: 0.75em;
      font-size: 0.95em;
      text-align: center;
      color: #555;
      background: #f9f9f9;
    }
    textarea { font-family: Arial, sans-serif; }
    button { border-radius: 8px; border: 1px solid #ccc; }
  </style>
</head>
<body>

<header>
  <h1>Plastering Apprentice App</h1>
</header>

<nav>
  <button onclick="showScreen('home')">Home</button>
  <button onclick="showScreen('guides')">Guides</button>
  <button onclick="showScreen('calculator')">Calculator</button>
  <button onclick="showScreen('progress')">Progress</button>
</nav>

<div id="home" class="screen active">
  <h2>Welcome!</h2>
  <p>Guides, calculators, and skill tracking for apprentice plasterers.</p>
  <p>Use <strong>Guides</strong> to learn, <strong>Calculator</strong> for quick estimates, and <strong>Progress</strong> to track skills with notes.</p>
</div>

<div id="guides" class="screen">
  <h2>Plastering Guides</h2>
  <div id="guideContent"></div>
</div>

<div id="calculator" class="screen">
  <h2>Plaster Calculator</h2>
  <label>Wall Width (m): <input type="number" id="width" step="0.1"></label><br><br>
  <label>Wall Height (m): <input type="number" id="height" step="0.1"></label><br><br>
  <label>Plaster Type:
    <select id="plasterType">
      <option value="standard">Standard</option>
      <option value="finishing">Finishing</option>
    </select>
  </label><br><br>
  <button onclick="calculatePlaster()" style="padding: 0.6em 0.9em;">Calculate</button>
  <p id="calcResult" style="white-space: pre-line; margin-top: 0.75em;"></p>
</div>

<div id="progress" class="screen">
  <h2>Progress Tracker</h2>
  <p>Your progress saves on this device.</p>
  <div id="progressList"></div>
</div>

<script>
  const guides = {
    "Dot & Dab Plastering": {
      steps: [
        "Ensure wall is clean, sound, and reasonably level.",
        "Mark vertical lines for dabs (about 300mm apart).",
        "Apply adhesive dabs along the lines (palm-sized).",
        "Press board onto dabs and tap with straight edge to level.",
        "Check plumb/flat as you go."
      ],
      placeholder: "Diagram: Wall with adhesive dabs and board being pressed level."
    },

    "Skimming": {
      steps: [
        "TOOLS NEEDED:",
        "‚Ä¢ Hawk, trowel, bucket trowel, paddle mixer, clean buckets, water brush",

        "MIXING:",
        "‚Ä¢ Always add plaster to water (not water to plaster)",
        "‚Ä¢ Mix until smooth and creamy ‚Äî like thick custard",
        "‚Ä¢ No lumps or dry powder",

        "FIRST COAT:",
        "‚Ä¢ Apply evenly and cover the full wall quickly",
        "‚Ä¢ Keep a wet edge ‚Äî don‚Äôt overwork it",
        "‚Ä¢ Don‚Äôt chase perfection on the first coat",

        "SECOND COAT (when first firms up):",
        "‚Ä¢ Apply thinner coat",
        "‚Ä¢ Fill low spots and flatten highs",
        "‚Ä¢ Work fast and keep edges wet",

        "TROWELING UP (TIMING IS KEY):",
        "‚Ä¢ Pass 1: flatten",
        "‚Ä¢ Pass 2: tighten up",
        "‚Ä¢ Final pass: polish with clean trowel + light water brush",

        "COMMON MISTAKES:",
        "‚Ä¢ Too wet (slides) / too dry (drags)",
        "‚Ä¢ Dirty tools causing scratches",
        "‚Ä¢ Going back too early or too late",
        "‚Ä¢ Letting edges dry out",

        "PRO TIPS:",
        "‚Ä¢ Clean tools constantly",
        "‚Ä¢ Small areas first when learning",
        "‚Ä¢ Work top to bottom",
        "‚Ä¢ Keep the trowel angle consistent"
      ],
      placeholder: "Diagram: Trowel angle + two skim coats with timing stages."
    },

    "Bonding": {
      steps: [
        "Control suction (dampen/PVA where needed).",
        "Apply bonding to level out uneven areas.",
        "Rule off with straight edge to flatten.",
        "Lightly scratch for key if skimming over.",
        "Let it firm up before finishing coat."
      ],
      placeholder: "Diagram: Bonding coat ruled off flat on uneven wall."
    },

    "Float Finishing": {
      steps: [
        "Apply base coat to required thickness.",
        "Use float to flatten and consolidate.",
        "Work in controlled sweeps to close surface.",
        "Fill hollows and trim highs as you go.",
        "Leave ready for skim or final finish."
      ],
      placeholder: "Diagram: Float motion arrows across wall surface."
    },

    "Applying Coving": {
      steps: [
        "Measure and mark internal/external corners.",
        "Cut accurate mitres using guide/box.",
        "Apply adhesive to rear edges.",
        "Press into position along ceiling line.",
        "Clean off excess and smooth joints."
      ],
      placeholder: "Diagram: Coving at wall/ceiling junction with adhesive."
    }
  };

  const skills = [
    "Dot & Dab Plastering",
    "Skimming",
    "Bonding",
    "Float Finishing",
    "Applying Coving"
  ];

  function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
    if (screenId === 'guides') loadGuides();
    if (screenId === 'progress') loadProgress();
  }

  // --- Guides + Skim Timer + photo/video placeholders ---
  function loadGuides() {
    const guideDiv = document.getElementById('guideContent');
    guideDiv.innerHTML = '';

    for (const skill in guides) {
      const data = guides[skill];
      const isSkimming = (skill === "Skimming");

      const stepsHtml = data.steps.map(step => `<li>${step}</li>`).join('');

      const skimmingExtras = isSkimming ? `
        <div style="margin-top: 0.75em; padding: 0.75em; border: 1px solid #ddd; border-radius: 10px;">
          <strong>‚è± Skim Timer</strong>
          <p style="margin: 0.5em 0;">Tap ‚ÄúStart First Coat‚Äù. You‚Äôll get reminders for second coat and troweling up.</p>
          <button onclick="startSkimTimer()" style="padding: 0.55em 0.85em;">Start First Coat</button>
          <button onclick="stopSkimTimer()" style="padding: 0.55em 0.85em; margin-left: 0.5em;">Stop</button>
          <p id="skimTimerStatus" style="margin-top: 0.6em;"></p>
          <small>Tip: timings vary by temperature/suction‚Äîuse reminders as a guide and check firmness.</small>
        </div>
      ` : '';

      const card = document.createElement('div');
      card.className = 'guide-card';
      card.innerHTML = `
        <h3>${skill}</h3>
        <ul>${stepsHtml}</ul>

        <div class="image-placeholder">
          ${data.placeholder}<br>
          <small>(Placeholder ‚Äì add real images later.)</small>
        </div>

        <div class="image-placeholder">
          üì∏ Photos: Good vs Bad finish (placeholder)
        </div>

        <div class="image-placeholder">
          üé• 30-sec clip (placeholder)
        </div>

        ${skimmingExtras}
      `;
      guideDiv.appendChild(card);
    }
  }

  // --- Skim Timer (browser alerts) ---
  let skimTimers = [];

  function startSkimTimer() {
    stopSkimTimer();

    const statusEl = document.getElementById('skimTimerStatus');
    if (statusEl) statusEl.textContent = "Timer started. Keep your edge wet.";

    skimTimers.push(setTimeout(() => {
      alert("Skimming: Check firmness ‚Äî time for SECOND COAT if the first is firming up.");
      const el = document.getElementById('skimTimerStatus');
      if (el) el.textContent = "Reminder: second coat window (check firmness).";
    }, 15 * 60 * 1000));

    skimTimers.push(setTimeout(() => {
      alert("Skimming: Start TROWELING UP (flatten pass).");
      const el = document.getElementById('skimTimerStatus');
      if (el) el.textContent = "Reminder: start troweling up (flatten).";
    }, 35 * 60 * 1000));

    skimTimers.push(setTimeout(() => {
      alert("Skimming: FINAL PASS / polish (light water brush if needed).");
      const el = document.getElementById('skimTimerStatus');
      if (el) el.textContent = "Reminder: final pass / polish stage.";
    }, 55 * 60 * 1000));
  }

  function stopSkimTimer() {
    skimTimers.forEach(t => clearTimeout(t));
    skimTimers = [];
    const statusEl = document.getElementById('skimTimerStatus');
    if (statusEl) statusEl.textContent = "Timer stopped.";
  }

  // --- Progress: checkbox + confidence + notes (saved) ---
  const PROGRESS_KEY = 'plastering_app_progress';

  function loadProgress() {
    const saved = JSON.parse(localStorage.getItem(PROGRESS_KEY) || '{}');
    const container = document.getElementById('progressList');
    container.innerHTML = '';

    skills.forEach(skill => {
      const itemSaved = saved[skill] || {};
      const checked = !!itemSaved.done;
      const confidence = typeof itemSaved.confidence === "number" ? itemSaved.confidence : 3;
      const notes = itemSaved.notes || "";

      const safeId = skill.replace(/\s+/g, '_').toLowerCase();
      const checkId = `done_${safeId}`;
      const sliderId = `conf_${safeId}`;
      const notesId = `notes_${safeId}`;
      const confLabelId = `confLabel_${safeId}`;

      const card = document.createElement('div');
      card.className = 'guide-card';
      card.innerHTML = `
        <label>
          <input type="checkbox" id="${checkId}" ${checked ? 'checked' : ''}>
          <strong>${skill}</strong>
        </label>

        <div style="margin-top: 0.75em;">
          <label for="${sliderId}">‚≠ê Confidence: <strong id="${confLabelId}">${confidence}/5</strong></label><br>
          <input type="range" id="${sliderId}" min="1" max="5" value="${confidence}" />
        </div>

        <div style="margin-top: 0.75em;">
          <label for="${notesId}">üìù Notes</label><br>
          <textarea id="${notesId}" rows="3" style="width: 100%;"></textarea>
        </div>
      `;
      container.appendChild(card);

      document.getElementById(notesId).value = notes;

      function save() {
        const current = JSON.parse(localStorage.getItem(PROGRESS_KEY) || '{}');
        current[skill] = current[skill] || {};
        current[skill].done = document.getElementById(checkId).checked;
        current[skill].confidence = Number(document.getElementById(sliderId).value);
        current[skill].notes = document.getElementById(notesId).value;
        localStorage.setItem(PROGRESS_KEY, JSON.stringify(current));
      }

      document.getElementById(checkId).addEventListener('change', save);
      document.getElementById(sliderId).addEventListener('input', (e) => {
        document.getElementById(confLabelId).textContent = `${e.target.value}/5`;
        save();
      });
      document.getElementById(notesId).addEventListener('input', save);
    });
  }

  // --- Calculator ---
  function calculatePlaster() {
    const width = parseFloat(document.getElementById('width').value);
    const height = parseFloat(document.getElementById('height').value);
    const type = document.getElementById('plasterType').value;

    if (isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
      alert('Please enter valid wall dimensions.');
      return;
    }

    const area = width * height; // m¬≤
    const coveragePerBag = (type === 'standard') ? 12 : 15; // rough estimate
    const bagsNeeded = Math.ceil(area / coveragePerBag);

    const waterRatio = (type === 'standard')
      ? "Water: follow bag instructions (often ~11‚Äì12L per 25kg)."
      : "Water: follow finishing plaster instructions (varies by product).";

    document.getElementById('calcResult').textContent =
      `Wall area: ${area.toFixed(2)} m¬≤\nApprox. bags needed: ${bagsNeeded}\n${waterRatio}`;
  }
</script>

</body>
</html>
